<head>
  <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.16/d3.min.js"></script>
  <script
  src="https://cdnjs.cloudflare.com/ajax/libs/d3plus/1.9.2/d3plus.full.min.js"></script>
  </head>
  <font face="Comic Sans MS,sans-serif"><div align ="center">
  <h1>Análisis predictivo de número de casos de COVID-19 a través de la movilidad social en territorio Español</h1> <br>

  Nombre: María Luisa Espada Durango<br>
Url: <a href="https://tfm-marialuisa.stackblitz.io">https://tfm-marialuisa.stackblitz.io</a> <br>

<h2>1. Introducción</h2></div>
<p><font face="Comic Sans MS,sans-serif">
Como todos sabemos y hemos sufrido, a finales del año 2019 apareció el virus COVID-19, también llamado SRAS-CoV-2, el cual se propagó rápidamente por todo el mundo, infectando a miles de personas e interrumpiendo la vida normal de todos los ciudadanos. </br></p>

<p>El COVID-19 ha demostrado ser muy contagioso ya que se propaga cuando una persona infectada exhala gotitas y partículas respiratorias muy pequeñas que contienen el virus. Estas gotitas y partículas respiratorias pueden ser inhaladas por otras personas o depositarse sobre sus ojos, nariz o boca.</br>

  <p>Dado al gran número de casos y las diferentes variantes a lo largo de los meses de este virus, los gobiernos se han visto obligados a tomar diferentes medidas de seguridad para poder mantener controlada la expansión de COVID-19.Por este motivo, durante estos dos últimos años, la movilidad de las personas se ha visto afectada, debido a que una de las principales medidas adoptadas por el Gobierno de España ha sido reducirla lo máximo posible para así supuestamente reducir el número de contagiados y frenar la expansión del virus. El Big data es una herramienta necesaria para el desarrollo de diferente toma de decisiones para tomar estas medidas y demostrar si son efectivas o de lo contrario no sirven.</br>
<div align ="center">
<h2>2. Objetivo</h2></div>
<p>Uno de los problemas principales planteados en la pandemia es evitar que los casos de COVID-19 vayan en aumento y demostrar si las medidas que afectan a la movilidad de los ciudadanos son efectivas o no para lograr este propósito. Por estos motivos, este proyecto tiene como objetivo general evitar el aumento de personas contagiadas del virus de COVID-19. Para ello se realiza este estudio y se pretende predecir el número de casos de COVID-19 por comunidad autónoma con respecto a la movilidad de los ciudadanos y las medidas de restricción tomadas. </br>

<p>En primer lugar, se lleva a cabo un análisis de las bases de datos disponibles, así como la preparación y compresión de los datos y limpieza de los mismos. Los datos utilizados para este TFM han sido recopilados del conjunto de datos de movilidad de Google (Google Mobility, s.f.) y los datos de casos de coronavirus por Comunidades Autónomas proporcionados por el Instituto de Salud Carlos III (ISCIII, s.f.). Estos datos han sido complementados con factores de restricciones a nivel de aforos en restaurantes, ocio nocturno, culto y teatros, así como con las fases de desescalada generados a partir de información encontrada en diversos medios de comunicación. Con estos datos se ha generado un único dataset para la realización del modelado de los datos. </br>

<p>Después se han realizado modelos estadísticos y algoritmos de Machine Learning para la predicción del número de casos de COVID-19 por comunidades autónomas. Para este proceso se ha realizado una división del conjunto de datos en datos de entrenamiento (train) y datos test. Esta división ha sido del 80% para train y el 20% para test.  Una vez dividido el dataset se procede a la realización del modelado. Para este proyecto se han utilizado métodos estadísticos y de machine learning. Los modelos utilizados han sido regresión lineal múltiple, series temporales, árboles de decisión y modelos de ensemble (RandomForest, AdaBoost, Gradient Boosting y XG Boost) para la predicción de casos de COVID-19 con relación a los factores de movilidad durante la pandemia. <br>

<div align ="center">
<h2>3. Modelos predictivos estadísticos y de machine learning</h2></div>
<p>La predicción estadística se puede definir como el uso de funciones matemáticas para estimar un valor de lo que se espera que pueda suceder. En este proceso existen discrepancias entre los valores predichos y los valores reales. Los modelos de predicción intentan evaluar estas discrepancias y aproximarse lo máximo posible a la realidad de los hechos.  <br>

<p>Para la predicción de los casos diarios de COVID-19 nos enfrentamos a un problema de regresión múltiple. Dado que este proyecto pretende encontrar la relación de los casos COVID-19 y la movilidad en España, se ha optado por aplicar técnicas de modelado basadas en regresión lineal múltiple, series temporales, árboles de decisión y modelos de ensemble de machine learning. <br>

<div align ="center">
<h2>4. Datos</h2></div>
<p style="color: #D35400">Datos de Google: <br>
<p>Estos datos muestran las tendencias de movimiento a lo largo del tiempo ordenadas por zonas geográficas y clasificadas en diversas categorías de lugares, como tiendas y espacios de ocio, supermercados y farmacias, parques, estaciones de transporte, lugares de trabajo y zonas residenciales. <br>

<h4>Datos estadísticos del conjunto de datos de Google. </h4>
<a href="https://ibb.co/XVL21PS"><img src="https://i.ibb.co/M9S2rHM/descriptivos-google.png" alt="descriptivos-google" border="0"></a><a target='_blank' href="https://maria-luisa-espa.imgbb.com/"></a><br>
<p>La torsión media de Retail and recreation es de -34.6912 y la mediana -28, la torsión media de grocery and pharmacy es de -10.7595 y la mediana -5, la torsión media de parks es 4.9798 y la mediana 0, la torsión media de transit station es de -31.9806 y la mediana -29, la torsión media de workplaces es de -27.0307 y la mediana de -24, por último, la torsión media de residential es de 9.2781 y su mediana 7.<br>
<p>Por otro lado, la tabla nos muestra los valores máximos y mínimos que toma cada variable objeto de estudio además de los cuartiles calculados. Los datos menores al cuartil 1 (Q1) representan el 25% de los datos, los que están por debajo del cuartil 2 (Q2) representan el 50% de los datos y los que están por debajo del cuartil 3 (Q3) representan el 75% de los datos. <br>
<p>En el recuento de los resultados (count) se observa que no faltan observaciones en las variables de estudio. Las desviaciones típicas son altas, con datos normales, la mayoría de las observaciones se encuentran dispersas a no más de 3 desviaciones estándar a cada lado.<br>
<p>Finalmente en las variables Parks y residentail parecen ser asimétricas a la derecha dado que su media es mayor a su mediana. Para el resto de observaciones parecen ser asimétricas a la izquierda por el efecto contrario. La siguiente ilustración corrobora lo explicado. <br>

<h4> Histogramas y Boxplot de las variables de estudio del conjunto de datos de Google.</h4>

<a href="https://ibb.co/mcVvbh9"><img src="https://i.ibb.co/DRHGzw9/download.png" alt="download" border="0" /><a target='_blank' href="https://maria-luisa-espa.imgbb.com/"></a><br />
<p>Para la observación de la existencia de valores atípicos se muestra la gráfica de los diagramas de cajas (Boxplot) de los atributos representados en la ilustración anterior. Las gráficas presentan datos atípicos en las variables, este se debe al cambio de restricciones a lo largo del tiempo, es decir que depende de si en las fechas en las que se recogieron los datos existían más o menos restricciones de movilidad y aforo. <br>

<h4>Matriz de correlaciones del conjunto de datos de Google. </h4>
<a href="https://ibb.co/R9zZ3Qr"><img src="https://i.ibb.co/2ygmvcV/download.png" alt="download" border="0"></a><a target='_blank' href="https://maria-luisa-espa.imgbb.com/"></a><br />
<p>La matriz de correlaciones presenta unos valores elevados a excepción de workplaces con parks. Esto tiene sentido ya que si la persona se desplaza al lugar de trabajo no se puede desplazar a los parques. La variable residential ofrece una correlación lineal fuerte negativa con respecto a las otras variables objeto de estudio. <br>
<h4>Evolución de la Variable ‘grocery and pharmacy’</h4>
<a href="https://ibb.co/t2X8nww"><img src="https://i.ibb.co/B6NqvHH/image66.png" alt="image66" border="0"></a><a target='_blank' href="https://maria-luisa-espa.imgbb.com/"></a><br />
<p>La variable de estudio grocery and pharmacy se desarrolla de una forma constante en la mayoría de los meses a excepción del mes de abril y mayo que sufre una caída en sus valores. Esto coincide con el comienzo de las imposiciones de movilidad impuestas por el gobierno de España a los ciudadanos y la declaración del estado de alarma debido a la pandemia de COVID-19.<br>
<h4>Evolución de la variable ‘parks’ </h4>
<a href="https://ibb.co/2chPRbp"><img src="https://i.ibb.co/DwWkmqj/parks.png" alt="parks" border="0"></a><a target='_blank' href="https://maria-luisa-espa.imgbb.com/"></a><br />
<p>Como en todas las variables el comienzo del descenso de los valores que toma la variable Parks coincide con el inicio de la aparición de los primeros casos de COVID-19 en España tomando sus peores valores en el mes de abril con el comienzo del estado de alarma. Esta variable se va incrementando poco a poco, la ‘desescalada’ de salida de los niños de sus casas empezó tímidamente con la relajación del confinamiento. La salida del confinamiento fue paulatinamente y en función del grado de contagiados por zonas. El aumento del valor de los casos se produce con la relajación de las restricciones de movilidad y aperturas de parques y centros de ocio. Así se observa que el mayor incremento de la salida a los parques se produce en los meses de verano manteniéndose constante el resto del año. </br>
<h4>Evolución de la variable ‘residential’</h4>
<a href="https://ibb.co/ykJyC8r"><img src="https://i.ibb.co/ZgC8rh0/residencias.png" alt="residencias" border="0"></a><a target='_blank' href="https://maria-luisa-espa.imgbb.com/"></a><br />
<p>Esta variable nos indica el los desplazamientos de las personas hacia su residencia habitual. Al contrario que las demás variables en esta se muestra un incremento con el inicio de las restricciones y la aparición de los primeros casos de COVID-9 en España. A lo largo del tiempo y con las fases de desescalada donde las restricciones de movilidad iban decreciendo la movilidad hacia las residencias habituales se fueron volviendo cada vez más constantes. </br>
<h4>Evolución de la variable ‘retail and recreation’</h4>
<a href="https://ibb.co/d46Jq1L"><img src="https://i.ibb.co/5hvxytn/retail.png" alt="retail" border="0"></a><a target='_blank' href="https://maria-luisa-espa.imgbb.com/"></a><br />
<p>La variable retail and recreation se refiere al comercio minorista y recreación. Esta variable se verá afectada negativamente en el mes de abril. Subiendo sus valores a medida que el nivel de restricciones bajaba. Tiene una estabilidad en los meses de verano, aunque a partir de octubre se vuelve a ver un decrecimiento en los valores. Esto se ve afectado, como se verá más adelante, por un aumento en el número de contagiados en estos últimos meses.<br>
<h4>Evolución de la variable ‘transit station’</h4>
<a href="https://ibb.co/SRQ1TwH"><img src="https://i.ibb.co/gzvX1ZQ/station.png" alt="station" border="0"></a><a target='_blank' href="https://maria-luisa-espa.imgbb.com/"></a><br />
<p>De la evolución de la variable tranasit station’ cabe destacar que solo se ve afectada en el mes de abril, a partir de mayo se observa constancia en ella, aunque no tome los valores tan altos como antes de que apareciera el nuevo virus COVID- 19. Este cambio se debe a la fomentación de teletrabajo y las medidas de expedientes temporales de regulación de empleo aplicadas en las empresas a lo largo de las fases de desescalada. <br>

<h4> Evolución de la variable ‘workplaces’ </h4>
<a href="https://ibb.co/yXVFVK0"><img src="https://i.ibb.co/KXmxmB6/workplaces.png" alt="workplaces" border="0"></a><a target='_blank' href="https://maria-luisa-espa.imgbb.com/"></a><br />
<p>La variable worplaces se refiere a los desplazamientos a centros de trabajo. Se observa claramente el parón en estos lugares con el comienzo del estado de alarma en abril. Una vez pasados los 15 días de paro de toda actividad no esencial, la variable empieza a tomar valores más positivos, aunque no como los meses anteriores a abril. Esto se debe a que se tomaron medidas como fomentar el teletrabajo para paliar la propagación del virus. Debido también a las restricciones de aforo y desescalada paulatina de centros de trabajo aumentaron los expedientes de regulación de empleo. Las comunidades autónomas más afectadas fueron Castilla y León, Andalucía y Cataluña. <br>

<p style="color: #D35400">Casos COVID-19 por comunidades autónomas: <br>
<p>Número de casos prueba diagnóstica y comunidad autónoma. Datos oficiales disponibles en la pestaña ‘Documentación y Datos’ de la web Situación de COVID-19 en España  del Instituto de Salud Carlos III (ISCIII) <a href="https://cnecovid.isciii.es/covid19/#documentaci%C3%B3n-y-datos">https://cnecovid.isciii.es/covid19/#documentaci%C3%B3n-y-datos</a><br>
<p>Los datos publicados en el Panel COVID-19 proceden de la declaración individualizada de casos COVID-19 a la Red Nacional de Vigilancia Epidemiológica (RENAVE) a través de la aplicación informática SiViEs.<br>

<h4>Datos estadísticos datos casos COVID-19 por comunidades autónomas</h4>
<a href="https://ibb.co/vh1XKb7"><img src="https://i.ibb.co/zFs601y/descriptivos-casos.png" alt="descriptivos-casos" border="0"></a></a><a target='_blank' href="https://maria-luisa-espa.imgbb.com/"></a><br />
<p>La torsión media de num_casos es de 510.69 y la mediana 119.0, la torsión media de num_prueba_pcr es de 315.62 y la mediana 91, la torsión media de num_prueba_test_ac es 0.34 y la mediana 0, la torsión media de num_prueba_ag es de 171.34 y la mediana 10, la torsión media de num_prueba_elisa es de 0.40 y la mediana de 0, por último, la torsión media de num_prueba_desconocida es de 22.98 y su mediana 0. Las variables parecen se asimétricas a la derecha dado que su media es mayor a su mediana. Los histogramas de la ilustración siguiente muestran esta situación.<br>
<h4>Histogramas variables de estudio del conjunto de datos casos COVID-19.</h4>
<a href="https://ibb.co/Rh2rQKg"><img src="https://i.ibb.co/N1xDWqF/image72.png" alt="image72" border="0"></a><a target='_blank' href="https://maria-luisa-espa.imgbb.com/"></a><br />
<p>En el recuento de los resultados (count) se observa en la tabla muestra que no faltan observaciones en las variables de estudio. Las desviaciones típicas son altas, a excepción de las variables ‘num_prueba_test_ac’ y ‘num_prueba_elisa’, con datos normales, la mayoría de las observaciones se encuentran dispersas a no más de 3 desviaciones estándar a cada lado.
La tabla también muestra los valores máximos y mínimos que toman cada variable objeto de estudio además de los cuartiles calculados. Los datos menores al cuartil 1 (Q1) representan el 25% de los datos, los que están por debajo del cuartil 2 (Q2) representan el 50% de los datos y los que están por debajo del cuartil 3 (Q3) representan el 75% de los datos.<br>

<h4>Matriz de correlaciones del conjunto de datos casos COVID-19.</h4>
<a href="https://ibb.co/mCjZctJ"><img src="https://i.ibb.co/zhM94bs/correlaciones-casos.png" alt="correlaciones-casos" border="0"></a><a target='_blank' href="https://maria-luisa-espa.imgbb.com/"></a><br />
<p>La correlación entre las variables num_casos y num_pruebas_pcr es alta al igual que la correlación entre num_casos y num_prueba_ac, esto quiere decir que las variables están altamente relacionadas y existe una relación lineal positiva y fuerte entre estas variables. En cuanto a las demás variables las correlaciones son bajas por tanto las variables no tienen relación lineal. <br>
<h4>Número de casos de COVID-19 por Comunidad Autónoma.</h4>
<a href="https://ibb.co/QFBvdg8"><img src="https://i.ibb.co/GvwQT6s/image42.png" alt="image42" border="0"></a><a target='_blank' href="https://maria-luisa-espa.imgbb.com/"></a><br />
<p>El histograma nos indica el número de personas que se han infectado del virus Covi-19 durante el año 2020. Observamos que la Comunidad de Madrid seguida de Cataluña son los datos más altos registrados. También hay que tener en cuenta que estas dos comunidades autónomas presentan un gran número de habitantes que residen en ellas. <br>
<h4>Número de casos de COVID-19 mensuales.</h4>
<a href="https://ibb.co/2s3Z7nV"><img src="https://i.ibb.co/1dGzfvy/image44.png" alt="image44" border="0"></a><a target='_blank' href="https://maria-luisa-espa.imgbb.com/"></a><br />
<p>En el histograma de número de casos de COVID-19 mensuales se obtiene la evolución de los casos de COVID-19 durante el estado de alarma y la imposición de las restricciones de movilidad, como se puede observar el número de casos de coronavirus desciende en los meses de mayo, junio y julio donde las restricciones de movilidad eran más severas. En los meses siguientes podemos ver un aumento de los casos de COVID- 19. Durante estos meses estas restricciones eran más permisivas por lo que podemos decir que las restricciones adoptadas en los meses anteriores fueron efectivas para controlar la expansión del coronavirus.<br>

<h4>Casos COVID-19 por comunidad autónoma y densidad de población.</h4><br>
<a href="https://ibb.co/BZddgt5"><img src="https://i.ibb.co/R0ZZC9k/image18.png" alt="image18" border="0"></a><a target='_blank' href="https://maria-luisa-espa.imgbb.com/"></a><br />

<br>
<h4>Una vez realizado el análisis exploratorio y visualización de los datos se procede a la siguiente fase de preparación de los datos. Se han añadido los datos de población, densidad de población, superficie, habitantes hombres y número de habitantes mujeres.También se han creado lo que se conoce como atributo dummy o one-hot-encodding a partir de la variable ‘iso_3166_2_code’ ya que han sido necesarias para el modelado de regresión lineal múltiple y árboles de decisión para regresión. Se procede a la construcción de un nuevo dataset resultado de la unión de los conjuntos de datos descritos anteriormente y que será el utilizado para la fase de modelado. El resultado de la unión de los conjuntos de datos anteriores ha formado un dataset  con las características que se muestran en la tabla.</h4>
<a href="https://ibb.co/m5HJRvt"><img src="https://i.ibb.co/Kx965N7/variables-finales.png" alt="variables-finales" border="0"></a></a><a target='_blank' href="https://maria-luisa-espa.imgbb.com/"></a><br />

<div align ="center">
<h2>4. Modelado de los datos</h2></div>

<p>Para el modelado de los datos se prueban diferentes métodos de predicción, tanto de técnicas estadísticas como de machine learning. Comprobaremos qué técnicas son las que se ajustan más a nuestros datos y mejores resultados nos ofrecen. <br>
<p>Para el proceso de modelado debemos dividir el dataset en dos, una parte de entrenamiento o train y otra parte para test. El set de entrenamiento nos permite entrenar el algoritmo. Este set es el que se utilizará para determinar el valor de los parámetros, nos ayuda automáticamente a encontrar los valores. El set de test o prueba nos ofrece una manera de corroborar que tanto nuestra selección de hiper parámetros, así como la de parámetros que fueron aprendidos funcionan con los nuevos datos, además de que utilizando este mismo conjunto de datos nos ayuda a tener un terreno justo para comprobar el desempeño de diversos algoritmos. El conjunto de datos lo dividiremos en 80% train y el 20% test. <br>
  <p>Las métricas de error utilizadas para todos los modelos realizados en el modelado son: <br>
  <h4>RMSE.<br></h4>
  Es una medida de ajuste que representa la raíz cuadrada de la distancia promedio entre el valor real y el error predicho. <br>
  <a href="https://ibb.co/S6MCYrm"><img src="https://i.ibb.co/b6C9wJv/rmse.png" alt="rmse" border="0"></a></a><a target='_blank' href="https://maria-luisa-espa.imgbb.com/"></a><br />

  
  Indica el ajuste absoluto del modelo a los datos, es decir, cuánto de cerca están los valores observados a los valores predichos. <br>
  A valores más bajos de RMSE mejor ajuste. <br>
  
  <h4>MAE.<br></h4>
  Es el promedio de la diferencia absoluta entre el valor real y el valor predicho.  Todas las diferencias individuales se ponderan por igual en el promedio. <br>
  <a href="https://ibb.co/Vxj73x0"><img src="https://i.ibb.co/42m6J2w/mae.png" alt="mae" border="0"></a></a><a target='_blank' href="https://maria-luisa-espa.imgbb.com/"></a><br />


  Cuanto mayor es el MAE peor es el ajuste. <br>
  <h4>R2.<br></h4>
  Coeficiente de determinación. Es la métrica de error que indica la calidad del modelo para predecir los resultados y la proporción de variación de éstos pueden explicarse por el modelo. <br>
  <a href="https://ibb.co/HCg4fbP"><img src="https://i.ibb.co/pQXwBMK/r2.png" alt="r2" border="0"></a></a><a target='_blank' href="https://maria-luisa-espa.imgbb.com/"></a><br />

  Este operador puede tomar valores entre 0 y 1. Cuanto más cerca esté de 1 mejor será el ajuste del modelo. <br>
  Estas métricas descritas serán las utilizadas en todo el proceso de modelado para determinar la eficacia de los distintos modelos probados y ejecutados, serán el punto de referencia para la decisión del modelo que se ajusta más al objetivo de predicción de número de casos de COVID-19. <br>
  
  <div align ="center">
<h3>4.1. Regresión lineal múltiple</h3></div>
<p>Empezaremos con una regresión lineal múltiple donde la variable dependiente es el número de casos, que es la variable que queremos predecir, y los atributos restantes serán las variables independientes. <br>
  <p>En este caso también tenemos una variable categórica ‘iso_3166_2_code’. Esta variable es transformada en lo que se conoce como atributo dummy o one-hot-encodding. Para explicar mejor lo que significa pondremos un ejemplo. La ecuación del modelo podría quedar de la siguiente forma: <br>
<a href="https://ibb.co/pr2MjT4"><img src="https://i.ibb.co/PzxPGy1/ejemplo1.png" alt="ejemplo1" border="0"></a></a><a target='_blank' href="https://maria-luisa-espa.imgbb.com/"></a><br />

<p>Si se quiere predecir el ‘número de casos’ de la Comunidad de Madrid, las variables Andalucía y Ceuta se consideran como 0, por tanto, para el caso de la Comunidad de Madrid sería el siguiente: <br>
<a href="https://ibb.co/LrRbKjH"><img src="https://i.ibb.co/zFxjd9D/ejemplo2.png" alt="ejemplo2" border="0"><a target='_blank' href="https://maria-luisa-espa.imgbb.com/"></a><br />
<p> Los resultados de las métricas de error se representan en la siguiente tabla: <br>
  <a href="https://ibb.co/SVcZGyt"><img src="https://i.ibb.co/WB0Rj5k/regresion.png" alt="regresion" border="0"><a target='_blank' href="https://maria-luisa-espa.imgbb.com/"></a><br />
<p>Los valores de R2 son altos lo que indican que las variables introducidas para el modelo explican una alta variabilidad observada en el número de casos de COVID-19. Por otra parte, el F-statistic es elevado en todos los modelos lo que muestra que la variabilidad de las medias de los grupos es grande en relación con la variabilidad dentro de los grupos. De esta manera rechazamos la hipótesis nula de que las medias de los grupos son iguales. 


<div align ="center">
<h3>4.2. Árboles de decisión</h3></div>
<p>Al igual que el modelo de regresión simple dividiremos el conjunto de datos en 80% train y el 20% test. El tipo de validación que se ha utilizado para la búsqueda de parámetros es el de validación cruzada. Este método permite evaluar la bondad de la estructura del árbol de decisión cuando se generaliza para una población mayor. Divide la muestra en número de submuestras, se generan a continuación los modelos de árbol que no incluyen cada submuestra. El primer árbol de decisión se basa en todos los casos excluyendo los de la primera submuestra, el segundo en todos los casos excepto los de la segunda submuestra y así sucesivamente. La validación cruzada genera un árbol de decisión único y final. <br />
<p>Para la creación del modelo se utiliza ‘DescisionTreeRegressor’ del módulo de ‘sklearn.tree’. Se ajusta el árbol de regresión utilizando como variable respuesta el número de casos y como variables predictoras las demás variables disponibles. <br />
<p>Los hiperparámetros por defecto son: <br />
Criterion = ‘mse’<br />
Splitter = ‘best’<br />
Max_depth =None<br />
Min_samples_split = 2<br />
Min_samples_leaf = 1<br />
Min_weight_fraction_leaf = 0.0<br />
Max_features = None<br />
Random_state = None<br />
Max_leaf_nodes = None<br />
Min_impurity_decrase = 0.0<br />
Min_impurity_split = None<br />
Ccp_alph= 0.0<br />
<p>Una vez creado y entrenado el modelo representamos el árbol. Este muestra el número de observaciones y el valor medio de la variable respuesta en cada nodo. La profundidad del árbol es de 4 y el número de nodos terminales 16.<br>
  <a href="https://ibb.co/bPfKJ2b"><img src="https://i.ibb.co/37JCzMR/image24.png" alt="image24" border="0"><a target='_blank' href="https://maria-luisa-espa.imgbb.com/"></a><br />
<p>Con la finalidad de mejorar la capacidad predictiva de este modelo se procede a podar, también llamado puring. Este proceso sirve para evitar el sobreajuste y ayuda a encontrar el árbol más sencillo para conseguir mejorar el resultado de la predicción. <br>
<p>Para la búsqueda del mejor parámetro de estimación se ha aplicado grid.best_params  lo que nos indica el estimador es la pérdida más pequeña de datos que quedan fuera. El resultado obtenido es que el mejor parámetro es 'ccp_alpha' como valor 0.00. Una vez identificado el valor óptimo se reentrena el árbol indicando este valor óptimo en los argumentos. Este proceso de puring ha identificado como mejor árbol mayor que el modelo inicialmente entrenado. La profundidad del árbol es 23 y el número de nodos terminales es 3187.<br>
<p>Por último, evaluamos la capacidad predictiva del árbol de decisión que hemos realizado primero y el árbol de decisión que se ha realizado en el proceso de podado empleando el conjunto de entrenamiento.<br>
<p>El RMSE del primer modelo es: 161.8144.<br>
<p>El RMSE del segundo modelo es: 19.9356.<br>
<p>El proceso de podado ha conseguido reducir el RMSE del modelo. Las predicciones del modelo final se alejan en promedio 19.9356 unidades del valor real.<br>
<p>A continuación, efectuamos el mismo proceso, pero por comunidades autónomas. Los resultados obtenidos se muestran en la tabla.<br>
<a href="https://ibb.co/YRnF3gX"><img src="https://i.ibb.co/dWCwrZt/arboles.png" alt="arboles" border="0"><a target='_blank' href="https://maria-luisa-espa.imgbb.com/"></a><br />
<p>Este modelo presenta buenos resultados, tanto la métrica MAE como RSME son muy bajas y la métrica de error R2 es alta, por tanto, este modelo nos indica que las variables introducidas para el modelo explican una alta variabilidad observada en el número de casos de COVID-19.<br>

<div align ="center">
<h3>4.3. Métodos ensemble de Machine Learning</h3></div>
<p>Para el modelado de los datos también se han utilizado métodos de ensemble o métodos combinados de machine learning, de esta manera se podrá decidir si se obtienen mejores resultados con modelos de estadística o con modelos de machine learning para este caso de estudio. <br>
<p>Estos modelos intentan ayudar a mejorar el rendimiento de los modelos de machine learning al mejorar su precisión. Este es un proceso en el cual se construye estratégicamente varios modelos de machine learning para resolver un problema particular. <br>
<p>Los utilizados de machine learning para el proyecto son RandomForest, Adaboost, Gradient Boosting y XGBoost.<br>
<P>Para decidir qué técnica es la más precisa y adecuada para nuestro proyecto, calculamos el MAE (error absoluto medio) y el RMSE (error cuadrático medio) para evaluar el error en los modelos.<br>
<p>Los resultados obtenidos a partir de los datos aplicando las técnias de machine learning son los siguientes: <br>
  <a href="https://ibb.co/7YTnZMD"><img src="https://i.ibb.co/mDY92ZK/machine.png" alt="machine" border="0"><a target='_blank' href="https://maria-luisa-espa.imgbb.com/"></a><br />
<p>Podemos ver en la tabla  buenos resultados excepto para Andalucía, Comunidad de Madrid y la Comunidad Valenciana. Las métricas de error muestran un MAE y un RMSE altos con respecto a las otras comunidades autónomas y la métrica del coeficiente de determinación son más bajos. En el caso de la Comunidad de Madrid el coeficiente de determinación es negativo por tanto se interpreta como si el valor de R2 fuese igual a cero, esto es que el modelo no explica nada de la variación total de la variable número de casos. <br>
<p>A partir estos resultados, podemos ver a continuación una comparación gráfica entre la evolución del número de casos reales y la evolución de los casos predichos. <br>
  <a href="https://ibb.co/LPJqQk4"><img src="https://i.ibb.co/1ndpsvH/image25.png" alt="image25" border="0"></a><a target='_blank' href="https://maria-luisa-espa.imgbb.com/"></a><br />  
  <a href="https://ibb.co/WVt3jCn"><img src="https://i.ibb.co/SfrxGSN/image26.png" alt="image26" border="0"></a><a target='_blank' href="https://maria-luisa-espa.imgbb.com/"></a><br />
  <a href="https://ibb.co/8jsLtcG"><img src="https://i.ibb.co/YtQFwZJ/image27.png" alt="image27" border="0"></a><a target='_blank' href="https://maria-luisa-espa.imgbb.com/"></a><br />
  <a href="https://ibb.co/wcJhrm0"><img src="https://i.ibb.co/rdb2fr7/image28.png" alt="image28" border="0"></a><a target='_blank' href="https://maria-luisa-espa.imgbb.com/"></a><br />
<div align ="center">
<h2>5.Evaluación y Conclusiones. </h2></div>
<p>El proceso de evaluación se basará en la comparación de los resultados obtenidos en la fase de modelado comparando los resultados de los diferentes modelos realizados para la consecución del objetivo principal de obtención de un modelo capaz de predecir el número de casos de COVID-19 a partir de los factores y restricciones de movilidad. En la siguiente tabla se muestran los resultados obtenidos y los modelos elegidos para cada comunidad autónoma de los modelos aplicados.<br>
<a href="https://ibb.co/wrMSzGS"><img src="https://i.ibb.co/0VhCG4C/resultados-finales.png" alt="resultados-finales" border="0"><a target='_blank' href="https://maria-luisa-espa.imgbb.com/"></a><br />
<p>Como se ha referenciado anteriormente, el objetivo general de este proyecto es evitar el aumento de contagios de COVID-19 y para ello se pretende encontrar un modelo de predicción e intentar pronosticar el número de casos de COVID-19 en España a partir de la movilidad de las personas a diferentes zonas por comunidades autónomas. Para ello se han utilizado diferentes modelos de predicción como regresión lineal múltiple, árboles de decisión, series temporales y métodos de ensemble de machine learning (XGBoost, AdaBoost, RandomForest y GradientBoosting).<br>
<p>Predecir un valor y estimar valores de hechos futuros a partir de una evaluación estadística no es tarea fácil y ha de tener en cuenta diferentes situaciones y datos correctos para poder aproximar el máximo posible los resultados. La fusión de diferentes fuentes de datos puede permitir obtener mejores resultados para el estudio de la pandemia.  Se ha comprobado que a pesar de tener diferentes y variadas bases de datos de orígenes distintos, no tienen por qué ser de calidad y servir para el objetivo de estudio. En este caso ha pasado con el conjunto de datos obtenidos de Apple. En un principio se realizó un análisis de la calidad de los datos para comprobar si podría ser de utilidad para el objetivo del proyecto, pero con el análisis de la calidad de los datos y el análisis estadístico de los mismos se desechó la idea de incluir el conjunto de datos para el estudio del COVID-19 debido a la gran cantidad de datos faltantes en las variables. Los datos elaborados por Google, los datos de restricciones obtenidos de la página web del gobierno español y la densidad de población obtenida del Instituto Nacional de Estadística han sido relevantes para el estudio de este proyecto. <br>
<p>No obstante, en este proyecto con los modelos realizados de regresión lineal múltiple, árboles de decisión, y métodos de ensemble de machine learning (XGBoost, AdaBoost, RandomForest y GradientBoosting),  al contrario con series temporales que se han obtenido unos resultados  no esperados en comparación con los demás modelos, han sido capaces de predecir una variabilidad de los datos superior al 80%, por lo que podrían ayudar a la toma de decisiones en la lucha contra la evolución y aumento de contagios de COVID-19 durante la pandemia. El uso de varios modelos de predicción ha permitido optimizar resultados. Una vez obtenidos los resultados de cada uno de los modelos para el conjunto de los datos se ha comprobado que, debido a la variabilidad en cada comunidad autónoma, cada una de ellas se adapta mejor a un modelo u otro. <br>
<p>Al realizar un estudio descriptivo previo del conjunto de datos y comparar las correlaciones entre los atributos, se han excluido variables para el modelado, proporcionando así unos valores de referencia para combatir la expansión de la pandemia de COVID-19. De esta manera, en todos los modelos, a parte de las características de movilidad, se ha incluido la densidad de población de cada una de las Comunidades Autónomas aumentando así el grado de variabilidad explicada en cada uno de ellos. Esto está relacionado de tal forma que a mayor densidad de población y afluencia de personas mayor probabilidad de contagio persona a persona de COVID-19.<br> 
<p>Con los resultados obtenidos en este trabajo y las bases de datos utilizadas se puede decir de forma objetiva que las medidas y restricciones adoptadas en la movilidad han sido influyentes para la predicción y evolución de la pandemia de COVID-19.<br>
<p>Todo este proceso ha sido desarrollado utilizando la metodología CRISP-DM lo que ha permitido efectuar este proyecto en todas las fases de la metodología, así como estudiar las diferentes bases de datos, perpetrar análisis de calidad y análisis estadísticos de los conjuntos de datos disponibles y aplicar modelos predictivos con los que se han obtenidos los diferentes resultados. <br>

  
  
   


