<head>
  <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.16/d3.min.js"></script>
  <script
  src="https://cdnjs.cloudflare.com/ajax/libs/d3plus/1.9.2/d3plus.full.min.js"></script>
  </head>
  <font face="Comic Sans MS,sans-serif"><div align ="center">
  <h1>Análisis predictivo de número de casos de COVID-19 a través de la movilidad social en territorio Español</h1> <br>

  Nombre: María Luisa Espada Durango<br>
Url: <a href="https://tfm-marialuisa.stackblitz.io">https://tfm-marialuisa.stackblitz.io</a> <br>

<h2>1. Introducción</h2></div>
<p><font face="Comic Sans MS,sans-serif">
Como todos sabemos y hemos sufrido, a finales del año 2019 apareció el virus COVID-19, también llamado SRAS-CoV-2, el cual se propagó rápidamente por todo el mundo, infectando a miles de personas e interrumpiendo la vida normal de todos los ciudadanos. </br></p>

<p>El COVID-19 ha demostrado ser muy contagioso ya que se propaga cuando una persona infectada exhala gotitas y partículas respiratorias muy pequeñas que contienen el virus. Estas gotitas y partículas respiratorias pueden ser inhaladas por otras personas o depositarse sobre sus ojos, nariz o boca.</br>

  <p>Dado al gran número de casos y las diferentes variantes a lo largo de los meses de este virus, los gobiernos se han visto obligados a tomar diferentes medidas de seguridad para poder mantener controlada la expansión de COVID-19.Por este motivo, durante estos dos últimos años, la movilidad de las personas se ha visto afectada, debido a que una de las principales medidas adoptadas por el Gobierno de España ha sido reducirla lo máximo posible para así supuestamente reducir el número de contagiados y frenar la expansión del virus. El Big data es una herramienta necesaria para el desarrollo de diferente toma de decisiones para tomar estas medidas y demostrar si son efectivas o de lo contrario no sirven.</br>
<div align ="center">
<h2>2. Objetivo</h2></div>
<p>Uno de los problemas principales planteados en la pandemia es evitar que los casos de COVID-19 vayan en aumento y demostrar si las medidas que afectan a la movilidad de los ciudadanos son efectivas o no para lograr este propósito. Por estos motivos, este proyecto tiene como objetivo general evitar el aumento de personas contagiadas del virus de COVID-19. Para ello se realiza este estudio y se pretende predecir el número de casos de COVID-19 por comunidad autónoma con respecto a la movilidad de los ciudadanos y las medidas de restricción tomadas. </br>

<p>En primer lugar, se lleva a cabo un análisis de las bases de datos disponibles, así como la preparación y compresión de los datos y limpieza de los mismos. Los datos utilizados para este TFM han sido recopilados del conjunto de datos de movilidad de Google (Google Mobility, s.f.) y los datos de casos de coronavirus por Comunidades Autónomas proporcionados por el Instituto de Salud Carlos III (ISCIII, s.f.). Estos datos han sido complementados con factores de restricciones a nivel de aforos en restaurantes, ocio nocturno, culto y teatros, así como con las fases de desescalada generados a partir de información encontrada en diversos medios de comunicación. Con estos datos se ha generado un único dataset para la realización del modelado de los datos. </br>

<p>Después se han realizado modelos estadísticos y algoritmos de Machine Learning para la predicción del número de casos de COVID-19 por comunidades autónomas. Para este proceso se ha realizado una división del conjunto de datos en datos de entrenamiento (train) y datos test. Esta división ha sido del 80% para train y el 20% para test.  Una vez dividido el dataset se procede a la realización del modelado. Para este proyecto se han utilizado métodos estadísticos y de machine learning. Los modelos utilizados han sido regresión lineal múltiple, series temporales, árboles de decisión y modelos de ensemble (RandomForest, AdaBoost, Gradient Boosting y XG Boost) para la predicción de casos de COVID-19 con relación a los factores de movilidad durante la pandemia. <br>

<div align ="center">
<h2>3. Modelos predictivos estadísticos y de machine learning</h2></div>
<p>La predicción estadística se puede definir como el uso de funciones matemáticas para estimar un valor de lo que se espera que pueda suceder. En este proceso existen discrepancias entre los valores predichos y los valores reales. Los modelos de predicción intentan evaluar estas discrepancias y aproximarse lo máximo posible a la realidad de los hechos.  <br>

<p>Para la predicción de los casos diarios de COVID-19 nos enfrentamos a un problema de regresión múltiple. Dado que este proyecto pretende encontrar la relación de los casos COVID-19 y la movilidad en España, se ha optado por aplicar técnicas de modelado basadas en regresión lineal múltiple, series temporales, árboles de decisión y modelos de ensemble de machine learning. <br>

<div align ="center">
<h2>4. Datos</h2></div>
<p style="color: #D35400">Datos de Google: <br>
<p>Estos datos muestran las tendencias de movimiento a lo largo del tiempo ordenadas por zonas geográficas y clasificadas en diversas categorías de lugares, como tiendas y espacios de ocio, supermercados y farmacias, parques, estaciones de transporte, lugares de trabajo y zonas residenciales. <br>

<h4>Datos estadísticos del conjunto de datos de Google. </h4>
<a href="https://ibb.co/XVL21PS"><img src="https://i.ibb.co/0Q2DTLh/descriptivos-google.png" alt="descriptivos-google" width="726" height="228" data-is360="0" data-load="full" class="" style="width: 726px; height: 228px; display: block;"><a target='_blank' href="https://maria-luisa-espa.imgbb.com/"></a><br>
<p>La torsión media de Retail and recreation es de -34.6912 y la mediana -28, la torsión media de grocery and pharmacy es de -10.7595 y la mediana -5, la torsión media de parks es 4.9798 y la mediana 0, la torsión media de transit station es de -31.9806 y la mediana -29, la torsión media de workplaces es de -27.0307 y la mediana de -24, por último, la torsión media de residential es de 9.2781 y su mediana 7.<br>
<p>Por otro lado, la tabla nos muestra los valores máximos y mínimos que toma cada variable objeto de estudio además de los cuartiles calculados. Los datos menores al cuartil 1 (Q1) representan el 25% de los datos, los que están por debajo del cuartil 2 (Q2) representan el 50% de los datos y los que están por debajo del cuartil 3 (Q3) representan el 75% de los datos. <br>
<p>En el recuento de los resultados (count) se observa que no faltan observaciones en las variables de estudio. Las desviaciones típicas son altas, con datos normales, la mayoría de las observaciones se encuentran dispersas a no más de 3 desviaciones estándar a cada lado.<br>
<p>Finalmente en las variables Parks y residentail parecen ser asimétricas a la derecha dado que su media es mayor a su mediana. Para el resto de observaciones parecen ser asimétricas a la izquierda por el efecto contrario. La siguiente ilustración corrobora lo explicado. <br>

<h4> Histogramas y Boxplot de las variables de estudio del conjunto de datos de Google.</h4>

<a href="https://ibb.co/mcVvbh9"><img src="https://i.ibb.co/DRHGzw9/download.png" alt="download" border="0" /><a target='_blank' href="https://maria-luisa-espa.imgbb.com/"></a><br />
<p>Para la observación de la existencia de valores atípicos se muestra la gráfica de los diagramas de cajas (Boxplot) de los atributos representados en la ilustración anterior. Las gráficas presentan datos atípicos en las variables, este se debe al cambio de restricciones a lo largo del tiempo, es decir que depende de si en las fechas en las que se recogieron los datos existían más o menos restricciones de movilidad y aforo. <br>
<h4>Matriz de correlaciones del conjunto de datos de Google. </h4>
<a href="https://ibb.co/pxJGf4V"><img class="viewer-src no-select animate --height-auto" src="https://i.ibb.co/pxJGf4V/download.png" alt="download.png" width="940" height="836"><a target='_blank' href="https://maria-luisa-espa.imgbb.com/"></a><br />
<p>La matriz de correlaciones presenta unos valores elevados a excepción de workplaces con parks. Esto tiene sentido ya que si la persona se desplaza al lugar de trabajo no se puede desplazar a los parques. La variable residential ofrece una correlación lineal fuerte negativa con respecto a las otras variables objeto de estudio. <br>
<h4>Evolución de la Variable ‘grocery and pharmacy’</h4>
<a href="https://https://ibb.co/t2X8nww"><img src="https://i.ibb.co/dpgGXss/image66.png" alt="image66" border="0"><a target='_blank' href="https://maria-luisa-espa.imgbb.com/"></a><br />
<p>La variable de estudio grocery and pharmacy se desarrolla de una forma constante en la mayoría de los meses a excepción del mes de abril y mayo que sufre una caída en sus valores. Esto coincide con el comienzo de las imposiciones de movilidad impuestas por el gobierno de España a los ciudadanos y la declaración del estado de alarma debido a la pandemia de COVID-19.<br>
<h4>Evolución de la variable ‘parks’ </h4>
<a href="https://ibb.co/2chPRbp"><img class="viewer-src no-select animate --height-auto" src="https://i.ibb.co/j3fGqpj/parks.png" alt="parks.png" width="1304" height="758"><a target='_blank' href="https://maria-luisa-espa.imgbb.com/"></a><br />
<p>Como en todas las variables el comienzo del descenso de los valores que toma la variable Parks coincide con el inicio de la aparición de los primeros casos de COVID-19 en España tomando sus peores valores en el mes de abril con el comienzo del estado de alarma. Esta variable se va incrementando poco a poco, la ‘desescalada’ de salida de los niños de sus casas empezó tímidamente con la relajación del confinamiento. La salida del confinamiento fue paulatinamente y en función del grado de contagiados por zonas. El aumento del valor de los casos se produce con la relajación de las restricciones de movilidad y aperturas de parques y centros de ocio. Así se observa que el mayor incremento de la salida a los parques se produce en los meses de verano manteniéndose constante el resto del año. </br>
<h4>Evolución de la variable ‘residential’</h4>
<a href="https://ibb.co/ykJyC8r"><img class="viewer-src no-select animate --height-auto" src="https://i.ibb.co/my7qKH3/residencias.png" alt="residencias.png" width="1304" height="743"><a target='_blank' href="https://maria-luisa-espa.imgbb.com/"></a><br />
<p>Esta variable nos indica el los desplazamientos de las personas hacia su residencia habitual. Al contrario que las demás variables en esta se muestra un incremento con el inicio de las restricciones y la aparición de los primeros casos de COVID-9 en España. A lo largo del tiempo y con las fases de desescalada donde las restricciones de movilidad iban decreciendo la movilidad hacia las residencias habituales se fueron volviendo cada vez más constantes. </br>
<h4>Evolución de la variable ‘retail and recreation’</h4>
<a href="https://ibb.co/d46Jq1L"><img src="https://i.ibb.co/9H23LzV/retail.png" alt="retail" border="0"></a></a><a target='_blank' href="https://maria-luisa-espa.imgbb.com/"></a><br />
<p>La variable retail and recreation se refiere al comercio minorista y recreación. Esta variable se verá afectada negativamente en el mes de abril. Subiendo sus valores a medida que el nivel de restricciones bajaba. Tiene una estabilidad en los meses de verano, aunque a partir de octubre se vuelve a ver un decrecimiento en los valores. Esto se ve afectado, como se verá más adelante, por un aumento en el número de contagiados en estos últimos meses.<br>
<h4>Evolución de la variable ‘transit station’</h4>
<a href="https://ibb.co/SRQ1TwH"><img src="https://i.ibb.co/bzHyh5Y/station.png" alt="station" border="0"></a></a><a target='_blank' href="https://maria-luisa-espa.imgbb.com/"></a><br />
<p>De la evolución de la variable tranasit station’ cabe destacar que solo se ve afectada en el mes de abril, a partir de mayo se observa constancia en ella, aunque no tome los valores tan altos como antes de que apareciera el nuevo virus COVID- 19. Este cambio se debe a la fomentación de teletrabajo y las medidas de expedientes temporales de regulación de empleo aplicadas en las empresas a lo largo de las fases de desescalada. <br>

<h4> Evolución de la variable ‘workplaces’ </h4>
<a href="https://ibb.co/yXVFVK0"><img src="https://i.ibb.co/TkrMrJc/workplaces.png" alt="workplaces" border="0"></a></a><a target='_blank' href="https://maria-luisa-espa.imgbb.com/"></a><br />
<p>La variable worplaces se refiere a los desplazamientos a centros de trabajo. Se observa claramente el parón en estos lugares con el comienzo del estado de alarma en abril. Una vez pasados los 15 días de paro de toda actividad no esencial, la variable empieza a tomar valores más positivos, aunque no como los meses anteriores a abril. Esto se debe a que se tomaron medidas como fomentar el teletrabajo para paliar la propagación del virus. Debido también a las restricciones de aforo y desescalada paulatina de centros de trabajo aumentaron los expedientes de regulación de empleo. Las comunidades autónomas más afectadas fueron Castilla y León, Andalucía y Cataluña. <br>

<p style="color: #D35400">Casos COVID-19 por comunidades autónomas: <br>
<p>Número de casos prueba diagnóstica y comunidad autónoma. Datos oficiales disponibles en la pestaña ‘Documentación y Datos’ de la web Situación de COVID-19 en España  del Instituto de Salud Carlos III (ISCIII) <a href="https://cnecovid.isciii.es/covid19/#documentaci%C3%B3n-y-datos">https://cnecovid.isciii.es/covid19/#documentaci%C3%B3n-y-datos</a><br>
<p>Los datos publicados en el Panel COVID-19 proceden de la declaración individualizada de casos COVID-19 a la Red Nacional de Vigilancia Epidemiológica (RENAVE) a través de la aplicación informática SiViEs.<br>

<h4>Datos estadísticos datos casos COVID-19 por comunidades autónomas</h4>
<a href="https://ibb.co/vh1XKb7"><img src="https://i.ibb.co/zFs601y/descriptivos-casos.png" alt="descriptivos-casos" border="0"></a></a><a target='_blank' href="https://maria-luisa-espa.imgbb.com/"></a><br />
<p>La torsión media de num_casos es de 510.69 y la mediana 119.0, la torsión media de num_prueba_pcr es de 315.62 y la mediana 91, la torsión media de num_prueba_test_ac es 0.34 y la mediana 0, la torsión media de num_prueba_ag es de 171.34 y la mediana 10, la torsión media de num_prueba_elisa es de 0.40 y la mediana de 0, por último, la torsión media de num_prueba_desconocida es de 22.98 y su mediana 0. Las variables parecen se asimétricas a la derecha dado que su media es mayor a su mediana. Los histogramas de la ilustración siguiente muestran esta situación.<br>
<h4>Histogramas variables de estudio del conjunto de datos casos COVID-19.</h4>
<a href="https://ibb.co/Rh2rQKg"><img src="https://i.ibb.co/Gs7YCDd/image72.png" alt="image72" border="0"></a></a><a target='_blank' href="https://maria-luisa-espa.imgbb.com/"></a><br />
<p>En el recuento de los resultados (count) se observa en la tabla muestra que no faltan observaciones en las variables de estudio. Las desviaciones típicas son altas, a excepción de las variables ‘num_prueba_test_ac’ y ‘num_prueba_elisa’, con datos normales, la mayoría de las observaciones se encuentran dispersas a no más de 3 desviaciones estándar a cada lado.
La tabla también muestra los valores máximos y mínimos que toman cada variable objeto de estudio además de los cuartiles calculados. Los datos menores al cuartil 1 (Q1) representan el 25% de los datos, los que están por debajo del cuartil 2 (Q2) representan el 50% de los datos y los que están por debajo del cuartil 3 (Q3) representan el 75% de los datos.<br>

<h4>Matriz de correlaciones del conjunto de datos casos COVID-19.</h4>
<a href="https://ibb.co/mCjZctJ"><img src="https://i.ibb.co/qMSqr9B/correlaciones-casos.png" alt="correlaciones-casos" border="0"></a></a><a target='_blank' href="https://maria-luisa-espa.imgbb.com/"></a><br />
<p>La correlación entre las variables num_casos y num_pruebas_pcr es alta al igual que la correlación entre num_casos y num_prueba_ac, esto quiere decir que las variables están altamente relacionadas y existe una relación lineal positiva y fuerte entre estas variables. En cuanto a las demás variables las correlaciones son bajas por tanto las variables no tienen relación lineal. <br>
<h4>Número de casos de COVID-19 por Comunidad Autónoma.</h4>
<a href="https://ibb.co/QFBvdg8"><img src="https://i.ibb.co/cc5hLBb/image42.png" alt="image42" border="0"></a></a><a target='_blank' href="https://maria-luisa-espa.imgbb.com/"></a><br />
<p>El histograma nos indica el número de personas que se han infectado del virus Covi-19 durante el año 2020. Observamos que la Comunidad de Madrid seguida de Cataluña son los datos más altos registrados. También hay que tener en cuenta que estas dos comunidades autónomas presentan un gran número de habitantes que residen en ellas. <br>
<h4>Número de casos de COVID-19 mensuales.</h4>
<a href="https://ibb.co/2s3Z7nV"><img src="https://i.ibb.co/5nhKWMp/image44.png" alt="image44" border="0"></a></a><a target='_blank' href="https://maria-luisa-espa.imgbb.com/"></a><br />
<p>En el histograma de número de casos de COVID-19 mensuales se obtiene la evolución de los casos de COVID-19 durante el estado de alarma y la imposición de las restricciones de movilidad, como se puede observar el número de casos de coronavirus desciende en los meses de mayo, junio y julio donde las restricciones de movilidad eran más severas. En los meses siguientes podemos ver un aumento de los casos de COVID- 19. Durante estos meses estas restricciones eran más permisivas por lo que podemos decir que las restricciones adoptadas en los meses anteriores fueron efectivas para controlar la expansión del coronavirus.<br>
<br>
<h4>Una vez realizado el análisis exploratorio y visualización de los datos se procede a la siguiente fase de preparación de los datos. Se han añadido los datos de población, densidad de población, superficie, habitantes hombres y número de habitantes mujeres.También se han creado lo que se conoce como atributo dummy o one-hot-encodding a partir de la variable ‘iso_3166_2_code’ ya que han sido necesarias para el modelado de regresión lineal múltiple y árboles de decisión para regresión. Se procede a la construcción de un nuevo dataset resultado de la unión de los conjuntos de datos descritos anteriormente y que será el utilizado para la fase de modelado. El resultado de la unión de los conjuntos de datos anteriores ha formado un dataset  con las características que se muestran en la tabla.</h4>
<a href="https://ibb.co/m5HJRvt"><img src="https://i.ibb.co/Kx965N7/variables-finales.png" alt="variables-finales" border="0"></a></a><a target='_blank' href="https://maria-luisa-espa.imgbb.com/"></a><br />

<div align ="center">
<h2>4. Modelado de los datos</h2></div>

<p>Para el modelado de los datos se prueban diferentes métodos de predicción, tanto de técnicas estadísticas como de machine learning. Comprobaremos qué técnicas son las que se ajustan más a nuestros datos y mejores resultados nos ofrecen. <br>
<p>Para el proceso de modelado debemos dividir el dataset en dos, una parte de entrenamiento o train y otra parte para test. El set de entrenamiento nos permite entrenar el algoritmo. Este set es el que se utilizará para determinar el valor de los parámetros, nos ayuda automáticamente a encontrar los valores. El set de test o prueba nos ofrece una manera de corroborar que tanto nuestra selección de hiper parámetros, así como la de parámetros que fueron aprendidos funcionan con los nuevos datos, además de que utilizando este mismo conjunto de datos nos ayuda a tener un terreno justo para comprobar el desempeño de diversos algoritmos. El conjunto de datos lo dividiremos en 80% train y el 20% test. <br>
  <div align ="center">
<h3>4.1. Regresión lineal múltiple</h3></div>



<div align ="center">
<h3>4.2. Árboles de decisión</h3></div>




<div align ="center">
<h3>4.3. Métodos ensemble de Machine Learning</h3></div>
